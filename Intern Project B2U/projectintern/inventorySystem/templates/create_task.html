<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Task - Beyond2U</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', 'Segoe UI', sans-serif;
    }
    body {
      background: linear-gradient(135deg, #f9fbff, #fffbea);
      color: #333;
      display: flex;
      min-height: 100vh;
    }

.sidebar {
  width: 230px;
  background: linear-gradient(180deg, #004aad, #5c9eff);
  color: white;
  padding: 35px 20px;
  display: flex;
  flex-direction: column;
  box-shadow: 4px 0 18px rgba(0, 0, 0, 0.1);
  border-top-right-radius: 22px;
  border-bottom-right-radius: 22px;
}

.sidebar h2 {
  font-size: 26px;
  text-align: center;
  margin-bottom: 40px;
  color: #ffeb70;
  text-shadow: 0 0 6px rgba(255,255,255,0.3);
}

.sidebar a {
  display: block;
  color: #fff;
  text-decoration: none;
  padding: 12px 15px;
  margin-bottom: 12px;
  border-radius: 10px;
  transition: all 0.3s ease;
  font-weight: 500;
  text-align: center;
  background: rgba(255, 255, 255, 0.15);
}

.sidebar a:hover {
  background: #ffda47;
  color: #004aad;
  font-weight: 600;
  transform: translateY(-3px);
}

.content {
  flex: 1;
  padding: 50px 60px;
  animation: fadeIn 0.7s ease-in-out;
}

@keyframes fadeIn {
  from {opacity: 0; transform: translateY(10px);}
  to {opacity: 1; transform: translateY(0);}
}

h1 {
  color: #004aad;
  font-size: 30px;
  margin-bottom: 25px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 25px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  overflow: hidden;
}

th, td {
  padding: 14px 18px;
  text-align: left;
}

th {
  background: #004aad;
  color: white;
  text-transform: uppercase;
  font-size: 14px;
}

tr:nth-child(even) {
  background: #f7f9ff;
}

.btn {
  padding: 7px 14px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.3s;
  font-weight: 500;
  text-decoration: none;
  display: inline-block;
}

.btn-update {
  background: linear-gradient(90deg, #004aad, #007bff);
  color: white;
}

.btn-update:hover {
  background: #ffda47;
  color: #004aad;
}

.update-form {
  background: #fff;
  margin-top: 40px;
  padding: 25px 35px;
  border-radius: 16px;
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
  max-width: 850px;
}

.update-form h3 {
  color: #004aad;
  margin-bottom: 15px;
}

label {
  display: block;
  font-weight: 600;
  color: #004aad;
  margin-bottom: 6px;
}

input, textarea, select {
  width: 100%;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 8px;
  background-color: #fafafa;
  margin-bottom: 15px;
}

input[readonly] {
  background: #f0f0f0;
  cursor: not-allowed;
}

button {
  padding: 12px 24px;
  background: linear-gradient(90deg, #004aad, #007bff);
  color: white;
  border: none;
  border-radius: 10px;
  font-weight: bold;
  font-size: 15px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

button:hover {
  background: linear-gradient(90deg, #ffdb4d, #ffd740);
  color: #003080;
  transform: translateY(-2px);
}

  </style>
</head>

<body>
  <div class="sidebar">
    <h2>Beyond2U</h2>
    <a href="{% url 'systemengineer_dashboard' %}">üè† Dashboard</a>
    <a href="{% url 'create_task' %}">üß© Assigned Task</a>
    <a href="{% url 'my_submissions' %}">üìÑ My Submissions</a>
    <a href="{% url 'notifications' %}">üîî Notifications</a>
    <a href="{% url 'logout' %}">üö™ Logout</a>
  </div>

  <div class="content">
    {% if is_teamlead %}
      <h1>Assign Task to Engineers</h1>
      <form method="POST">
        {% csrf_token %}
        <label>Select Engineer:</label>
        <select name="engineer_id" required>
          {% for e in engineers %}
            <option value="{{ e.id }}">{{ e.username }}</option>
          {% endfor %}
        </select>

    <label>Task Type:</label>
    <input type="text" name="replacement_type" placeholder="e.g., Tech Refresh">

    <label>Location:</label>
    <input type="text" name="location" placeholder="Enter task location">

    <label>User Name:</label>
    <input type="text" name="user_name" placeholder="Enter user name">

    <label>Barcode:</label>
    <input type="text" name="barcode" placeholder="Enter barcode">

    <label>Serial Number:</label>
    <input type="text" name="serial_number" placeholder="Enter serial number">

    <button type="submit">Assign Task</button>
  </form>

{% else %}
  <h1>My Assigned Tasks</h1>
  {% if assigned_tasks %}
    <table>
      <tr>
        <th>Engineer</th>
        <th>Type</th>
        <th>Location</th>
        <th>User</th>
        <th>Barcode</th>
        <th>Serial No.</th>
        <th>Date Assigned</th>
        <th>Action</th>
      </tr>
      {% for task in assigned_tasks %}
      <tr>
        <td>{{ task.engineer.username }}</td>
        <td>{{ task.replacement_type }}</td>
        <td>{{ task.location }}</td>
        <td>{{ task.username }}</td>
        <td>{{ task.barcode }}</td>
        <td>{{ task.serial_number }}</td>
        <td>{{ task.assigned_date|date:"d M Y" }}</td>
        <td><a href="?task_id={{ task.id }}" class="btn btn-update">Update</a></td>
      </tr>
      {% endfor %}
    </table>
  {% else %}
    <p>No tasks assigned yet.</p>
  {% endif %}

  {% if selected_task %}
    <div class="update-form">
      <h3>Submit Task: {{ selected_task.replacement_type }}</h3>

    <form method="POST" action="{% url 'submit_task' selected_task.id %}" enctype="multipart/form-data">
        {% csrf_token %}
        <label>Engineer Name</label>
        <input type="text" name="engineer_name" value="{{ user.username }}" readonly>

        <label>Barcode</label>
        <input type="text" name="barcode" value="{{ selected_task.barcode }}" readonly>

        <label>Serial Number</label>
        <input type="text" name="serial_number" value="{{ selected_task.serial_number }}" readonly>

        <label>Location</label>
        <input type="text" name="location" value="{{ selected_task.location }}" readonly>

        <label>Username</label>
        {% if selected_task.username %}
          <input type="text" name="user_name" value="{{ selected_task.username }}" readonly>
        {% else %}
          <input type="text" name="user_name" placeholder="Enter user name" required>
        {% endif %}

        <label>Old Hostname</label>
        <input type="text" name="old_hostname" placeholder="Enter old hostname">

        <label>New Hostname</label>
        <input type="text" name="new_hostname" placeholder="Enter new hostname">

        <label>Old Serial Number</label>
        <input type="text" name="old_serial" placeholder="Enter old serial number">

        <label>New Serial Number</label>
        <input type="text" name="new_serial" placeholder="Enter new serial number">

        <label>Status</label>
        <select name="status" required>
            <option value="">-- Select Status --</option>
            <option value="Done">Done</option>
            <option value="Pending">Pending</option>
            <option value="Incomplete">Incomplete</option>
            <option value="Rescheduled">Rescheduled</option>
          </select>

        <label>Date (If rescheduled)</label>
        <input type="date" name="rescheduled_date">

        <label>Format Status</label>
        <select name="format_status" required>
            <option value="">-- Select Status --</option>
            <option value="Done">Done</option>
            <option value="Pending">Pending</option>
            <option value="In Progress">In Progress</option>
            <option value="Not Yet Started">Not Yet Started</option>
          </select>

        <label>Reason (If haven't formatted)</label>
        <input type="text" name="reason_not_formatted" placeholder="Enter reason if not formatted">

        <label>Upload Status</label>
        <select name="upload_status" required>
            <option value="">-- Select Status --</option>
            <option value="Done">Done</option>
            <option value="Pending">Pending</option>
            <option value="In Progress">In Progress</option>
          </select>

        <label>Reason (If haven't uploaded)</label>
        <input type="text" name="reason_not_uploaded" placeholder="Enter reason if not uploaded">

        <label>Remarks</label>
        <textarea name="remarks" rows="3" placeholder="Enter remarks"></textarea>

        <label>Upload Proof (image/pdf)</label>
        <input type="file" name="proof" accept="image/*,application/pdf">

        <button type="submit">Submit Task</button>
      </form>
    </div>
  {% endif %}
{% endif %}

  </div>
</body>
</html>
